---
import { locales } from "@languages";
import { tForLocale } from "@utils/translation";
import { Icon } from "astro-icon/components";
import { getRelativeLocaleUrl } from "astro:i18n";
import '@styles/dropdown-selector.css';

const { locale: currentLocale } = Astro.locals;
const { ...attributes } = Astro.props;

const currentLocaleName = tForLocale(currentLocale, "locale_current_name");
---

<div class="locale-selector dropdown-wrapper" {...attributes}>
  {/* Desktop Dropdown Trigger */}
  <button class="dropdown-trigger dropdown-link" aria-haspopup="true" aria-expanded="false" aria-label={`Select language. Current language: ${currentLocaleName}`}>
    <Icon name={`circle-flags:${currentLocale}`} class="flag-icon" width="24" height="24" aria-hidden="true" />
    <span class="locale-label">{currentLocaleName}</span>
    <Icon name="arrow" width="14" height="14" class="chevron" aria-hidden="true" />
  </button>

  {/* The List of Locales */}
  <nav class="dropdown-menu" aria-label="Select language">
    <ul class="dropdown-list">
      {locales.map((locale) => (
        <li>
          <a 
            href={getRelativeLocaleUrl(locale)} 
            class:list={["dropdown-link", { "is-active": locale === currentLocale }]}
            aria-current={locale === currentLocale ? "page" : undefined}
            title={locale.toUpperCase()} 
            aria-label={`Switch to ${tForLocale(locale, "locale_current_name")}`}
          >
            <Icon name={`circle-flags:${locale}`} class="flag-icon" width="24" height="24" aria-hidden="true" /> 
            <span class="locale-label">{tForLocale(locale, "locale_current_name")}</span>
          </a>
        </li>
      ))}
    </ul>
  </nav>
</div>

<style>
  /* We only need to define specific overrides here */
  .dropdown-trigger {
    font-size: 1.1rem;
    /* Reset button styles for the trigger since it uses the shared link class */
    background: transparent;
    border: none;
    font-family: inherit;
  }

  .flag-icon {
    border-radius: 50%;
  }
</style>