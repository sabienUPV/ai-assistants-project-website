---
import { supportedLangs } from "@utils/translation"
import { baseUrl as base } from "@utils/url"
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Redirecting...</title>

    <meta http-equiv="refresh" content={`0;url=${base}/en/`} />

    <script is:inline define:vars={{ supportedLangs, base }}>
      const userLang = navigator.language || navigator.userLanguage; // Support older browsers
      const defaultLang = "en";

      // Find if any of our supported langs are at the start of the user's browser lang
      // e.g., 'en-US' matches 'en'
      const matchedLang = supportedLangs.find(lang => userLang.startsWith(lang));

      const finalLang = matchedLang || defaultLang;

      // Construct the final URL using the base path
      // e.g. "/my-repo" + "/" + "en" + "/"
      window.location.replace(`${base}/${finalLang}/`);
    </script>

    <style>
      /* The Logic:
         1. Start completely hidden (opacity: 0).
         2. Wait 0.1 seconds.
         3. Snap to visible (opacity: 1).
      */
      .fallback-message {
        opacity: 0;
        animation: reveal 0s 0.1s forwards; /* Duration: 0s, Delay: 0.1s */
        
        /* Make it look decent if it does appear */
        font-family: system-ui, sans-serif;
        text-align: center;
        margin-top: 2rem;
        color: #333;
      }

      @keyframes reveal {
        to { opacity: 1; }
      }
    </style>
  </head>
  <body>
    
    <div class="fallback-message">
      <p>Redirecting you to the English version...</p>
      <p>
        <a href={`${base}/en/`}>Click here manually if nothing happens.</a>
      </p>
    </div>

  </body>
</html>